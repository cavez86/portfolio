# Portfolio Project - Copilot Instructions

## Project Overview

This is a **Next.js 16.0.1** portfolio website with **PayloadCMS** as a headless CMS backend. The project is a
medium-sized TypeScript application (~72 source files, ~500KB) featuring internationalization (i18n), server-side
rendering, and PDF generation capabilities.

**Key Technologies:**

- **Runtime:** Bun 1.1.38 (JavaScript/TypeScript runtime and package manager)
- **Package Manager:** Bun 1.1.38 (bundled with Bun runtime)
- **Framework:** Next.js 16.0.1 with App Router and React 19.2.0
- **CMS:** PayloadCMS 3.60.0 with Vercel Postgres adapter
- **Styling:** Tailwind CSS v4 (via @tailwindcss/postcss)
- **UI Components:** shadcn/ui (Radix UI primitives)
- **State Management:** tRPC 11.1.1 with React Query
- **i18n:** next-intl supporting English and Italian
- **Testing:** Vitest 4.0.6
- **Linting/Formatting:** ESLint 9.38.0, Prettier 3.6.2

## Critical Setup Requirements

### 1. Installing Dependencies

**ALWAYS run this first before any other commands:**

```bash
bun install --frozen-lockfile
```

- Takes approximately 20-30 seconds (faster than pnpm/npm)
- Bun is an all-in-one toolkit that includes a runtime, package manager, bundler, and test runner
- The `--frozen-lockfile` flag ensures reproducible installs by using the exact versions in `bun.lockb`

### 2. Build Limitations

**IMPORTANT:** The build command (`bun run build`) will FAIL in sandboxed environments because it attempts to fetch Google
Fonts (Geist) from `fonts.googleapis.com`. This is expected behavior and NOT a bug to fix.

The build command:

```bash
bun run build  # Takes 2-5 minutes when fonts are accessible
```

**Workaround:** To validate code changes without building, use these commands instead:

- `bun run type-check` - TypeScript type validation (NOTE: Shows errors in `.next/types/validator.ts` - these are
  pre-existing, generated by Next.js, and ignored via `typescript.ignoreBuildErrors: true`)
- `bun run lint` - ESLint with auto-fix (fast, ~10 seconds)
- `bun run format` - Prettier formatting (fast, ~5 seconds)
- `bun test` - Run Vitest tests (currently no test files, runs with `--passWithNoTests`)

## Validation Workflow (CI Pipeline)

The GitHub Actions workflow (`.github/workflows/pr.yml`) runs on every PR to `main` and executes in this order:

1. `bun install --frozen-lockfile`
2. `bun run lint` - ESLint checks
3. `bun run type-check` - TypeScript compilation check
4. `bun run format` - Prettier formatting check
5. `bun test` - Vitest tests

**ALWAYS run these commands locally before committing to ensure CI passes.**

## Pre-commit Hooks

Husky is configured with a pre-commit hook that runs `lint-staged`:

- Runs `bun run format` on all changed files
- Runs `bun run lint` on .js, .jsx, .ts, .tsx files
- Runs `tsc --noEmit` type checking on TypeScript files

**Note:** When using git commands directly, set `HUSKY=0` environment variable to skip hooks if needed.

## Project Structure

### Root Configuration Files

- `next.config.ts` - Next.js config with Payload and next-intl plugins
- `tsconfig.json` - TypeScript config with path aliases (@/_ → ./src/_)
- `eslint.config.mjs` - ESLint flat config with Next.js and Prettier
- `prettier.config.mjs` - Prettier with Tailwind and import sorting plugins
- `postcss.config.mjs` - PostCSS with Tailwind CSS v4
- `components.json` - shadcn/ui configuration
- `lint-staged.config.mjs` - Pre-commit validation rules
- `package.json` - Dependencies and scripts

### Source Code Organization (`src/`)

#### `src/app/` - Next.js App Router

- `(frontend)/[locale]/` - Main frontend with i18n routing (en, it)
  - `page.tsx` - Home page
  - `layout.tsx` - Frontend layout with theme provider
  - `error.tsx`, `loading.tsx`, `not-found.tsx` - Error handling
- `(payload)/` - PayloadCMS admin panel routes
  - `admin/[[...segments]]/page.tsx` - Admin UI
  - `api/` - Payload API routes
- `api/trpc/[trpc]/` - tRPC API endpoints
- `layout.tsx` - Root layout with Geist font loading
- `globals.css` - Tailwind CSS v4 theme with light/dark modes

#### `src/collections/` - PayloadCMS Collections (10 files)

Data models: Users, Contacts, Education, Experience, Languages, Media, PersonalInfo, Skills, SoftSkills, SummaryInfo

#### `src/components/` - React Components

- `ui/` - shadcn/ui components (Badge, Button, Card, Dialog, etc.)
- `common/` - Shared components (Icon, LanguageSelector, ScrollProgress, etc.)
- `sections/` - Page sections (HeroSection, SkillsSection, ContactSection, etc.)
- `cards/` - Data cards (ExperienceCard, SkillsCard)
- `providers/` - Context providers (ThemeProvider, IntlErrorHandlingProvider)
- `pdf/` - PDF generation components using @react-pdf/renderer

#### `src/server/trpc/` - tRPC Backend

- `init.ts` - tRPC context and procedure initialization
- `router.ts` - Root router combining sub-routers
- `routers/` - Individual routers (pdf.tsx for PDF generation)

#### `src/i18n/` - Internationalization

- `routing.ts` - Locale configuration (en, it)
- `navigation.ts` - i18n-aware navigation helpers
- `request.ts` - Server-side request handling

#### Other Important Directories

- `messages/` - Translation files (en.json, it.json)
- `public/` - Static assets (SVG icons, robots.txt)

### Environment Variables

The following environment variables are used (all optional for development):

- `DATABASE_URL` - Vercel Postgres connection string (for PayloadCMS)
- `PAYLOAD_SECRET` - Secret for Payload admin authentication
- `RESEND_API_KEY` - API key for Resend email adapter
- `VERCEL_URL` - Vercel deployment URL (auto-set on Vercel)
- `PORT` - Development server port (defaults to 3000)

## Development Commands

### Running the Development Server

```bash
bun dev  # Starts Next.js dev server on http://localhost:3000
```

### Code Quality Commands

```bash
bun run lint              # Run ESLint with auto-fix
bun run format            # Format code with Prettier
bun run type-check        # TypeScript type checking (no emit)
bun test                  # Run Vitest tests
```

### PayloadCMS CLI

```bash
bun run payload [command]  # Access Payload CLI (requires PAYLOAD_CONFIG_PATH env var)
```

## Common Issues and Workarounds

### 1. Build Fails with Google Fonts Error

**Expected behavior** in sandboxed environments. Use `bun run type-check` instead to validate TypeScript.

### 2. Bun Installation

Install globally from https://bun.sh or use:
```bash
curl -fsSL https://bun.sh/install | bash
```

### 3. Dependency Installation Warnings

The warning about ignored build scripts for `@vercel/speed-insights`, `sharp`, etc. may appear. This is normal and can be ignored.

### 4. TypeScript Type Errors in .next Directory

The `bun run type-check` command reports errors in `.next/types/validator.ts`. These are:

- **Pre-existing** errors in Next.js-generated type validation files
- **Intentionally ignored** via `typescript.ignoreBuildErrors: true` in `next.config.ts`
- **Not a sign of broken code** - the CI pipeline allows these errors
- **Do not attempt to fix** these errors as they are in generated files

When validating your changes, focus on errors in your source files (`src/`), not in `.next/` directory.

## Making Code Changes

### Path Aliases

Use these TypeScript path aliases (defined in `tsconfig.json`):

- `@/*` → `./src/*`
- `@payload-config` → `./src/payload.config.ts`

### Styling

- Use Tailwind CSS v4 utility classes
- Theme colors are defined in `src/app/globals.css`
- Dark mode is handled via `next-themes` with `.dark` class

### Adding Components

For UI components, this project uses shadcn/ui. Check `components.json` for configuration.

### Code Style

- Single quotes for strings
- 120 character line width
- Trailing commas (ES5)
- Auto-organize imports (via prettier-plugin-organize-imports)
- Auto-format Tailwind classes (via prettier-plugin-tailwindcss)

## Testing Strategy

Currently, the project has no test files but is configured for Vitest. When adding tests:

- Place test files adjacent to source files with `.test.ts` or `.spec.ts` extension
- Run tests with `bun test`
- CI runs tests with `--passWithNoTests` flag

## Trust These Instructions

**These instructions have been validated by running actual commands and inspecting real configuration files.**

Only search for additional information if:

1. You encounter an error not documented here
2. You need to understand specific implementation details
3. These instructions contradict actual file contents (in which case, file contents are authoritative)

For routine tasks like linting, type-checking, and validation, follow the commands and workflows documented above
without additional exploration.
